@model SAFA_ECC_Core_Clean.Models.Inward_Trans

@{
    ViewData["Title"] = "تفاصيل الشيك الوارد";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-file-alt me-2"></i>
                            تفاصيل الشيك الوارد - @Model.Serial
                        </h4>
                        <div>
                            <a asp-action="Index" class="btn btn-light">
                                <i class="fas fa-arrow-right me-1"></i>
                                العودة للقائمة
                            </a>
                            <a asp-action="Edit" asp-route-id="@Model.Serial" class="btn btn-warning">
                                <i class="fas fa-edit me-1"></i>
                                تعديل
                            </a>
                        </div>
                    </div>
                </div>

                <div class="card-body">
                    <div class="row">
                        <!-- Basic Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">
                                        <i class="fas fa-info-circle me-2"></i>
                                        المعلومات الأساسية
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>التسلسل:</strong></div>
                                        <div class="col-sm-8">@Model.Serial</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم التسلسل:</strong></div>
                                        <div class="col-sm-8">@Model.ChqSequance</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم الشيك:</strong></div>
                                        <div class="col-sm-8">@Model.DrwChqNo</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>المبلغ:</strong></div>
                                        <div class="col-sm-8">
                                            <span class="fw-bold text-success fs-5">
                                                @Model.Amount?.ToString("N2") @Model.Currency
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>تاريخ المعاملة:</strong></div>
                                        <div class="col-sm-8">@Model.TransDate?.ToString("dd/MM/yyyy HH:mm")</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>تاريخ الاستحقاق:</strong></div>
                                        <div class="col-sm-8">@Model.ValueDate?.ToString("dd/MM/yyyy")</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>الحالة:</strong></div>
                                        <div class="col-sm-8">
                                            @switch (Model.Status)
                                            {
                                                case "NEW":
                                                    <span class="badge bg-info fs-6">جديد</span>
                                                    break;
                                                case "PENDING":
                                                    <span class="badge bg-warning fs-6">في الانتظار</span>
                                                    break;
                                                case "AUTHORIZED":
                                                    <span class="badge bg-success fs-6">معتمد</span>
                                                    break;
                                                case "RETURNED":
                                                    <span class="badge bg-danger fs-6">مرجع</span>
                                                    break;
                                                case "POSTED":
                                                    <span class="badge bg-primary fs-6">مرحل</span>
                                                    break;
                                                default:
                                                    <span class="badge bg-secondary fs-6">@Model.Status</span>
                                                    break;
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">
                                        <i class="fas fa-university me-2"></i>
                                        معلومات البنك والحساب
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم البنك:</strong></div>
                                        <div class="col-sm-8">@Model.DrwBankNo</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم الفرع:</strong></div>
                                        <div class="col-sm-8">@Model.DrwBranchNo</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم الحساب:</strong></div>
                                        <div class="col-sm-8">@Model.DrwAcctNo</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>فرع المستفيد:</strong></div>
                                        <div class="col-sm-8">@Model.BenfAccBranch</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم القسم:</strong></div>
                                        <div class="col-sm-8">@Model.DeptNo</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>مركز المقاصة:</strong></div>
                                        <div class="col-sm-8">@Model.ClrCenter</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Drawer Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">
                                        <i class="fas fa-user me-2"></i>
                                        معلومات الساحب
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>اسم الساحب:</strong></div>
                                        <div class="col-sm-8">@Model.DrwName</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم الهوية:</strong></div>
                                        <div class="col-sm-8">@Model.DrwCardId</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Beneficiary Information -->
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">
                                        <i class="fas fa-user-check me-2"></i>
                                        معلومات المستفيد
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>اسم المستفيد:</strong></div>
                                        <div class="col-sm-8">@Model.BenName</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم الحساب:</strong></div>
                                        <div class="col-sm-8">@Model.BenAccountNo</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>رقم الهوية:</strong></div>
                                        <div class="col-sm-8">@Model.BenfCardId</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>نوع الهوية:</strong></div>
                                        <div class="col-sm-8">@Model.BenfCardType</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-sm-4"><strong>الجنسية:</strong></div>
                                        <div class="col-sm-8">@Model.BenfNationality</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Status and Actions -->
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">
                                        <i class="fas fa-cogs me-2"></i>
                                        الحالة والعمليات
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="row mb-2">
                                                <div class="col-sm-3"><strong>مرحل:</strong></div>
                                                <div class="col-sm-3">
                                                    @if (Model.Posted == 1)
                                                    {
                                                        <span class="badge bg-success">نعم</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-warning">لا</span>
                                                    }
                                                </div>
                                                <div class="col-sm-3"><strong>مرجع:</strong></div>
                                                <div class="col-sm-3">
                                                    @if (Model.Returned == true)
                                                    {
                                                        <span class="badge bg-danger">نعم</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-success">لا</span>
                                                    }
                                                </div>
                                            </div>
                                            @if (Model.Returned == true && !string.IsNullOrEmpty(Model.ReturnCode))
                                            {
                                                <div class="row mb-2">
                                                    <div class="col-sm-3"><strong>كود الإرجاع:</strong></div>
                                                    <div class="col-sm-9">
                                                        <span class="badge bg-danger">@Model.ReturnCode</span>
                                                        @if (Model.ReturnCodeNavigation != null)
                                                        {
                                                            <span class="ms-2">@Model.ReturnCodeNavigation.Description_AR</span>
                                                        }
                                                    </div>
                                                </div>
                                            }
                                            <div class="row mb-2">
                                                <div class="col-sm-3"><strong>معاملة خاصة:</strong></div>
                                                <div class="col-sm-3">
                                                    @if (Model.SpecialHandling == true)
                                                    {
                                                        <span class="badge bg-warning">نعم</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-secondary">لا</span>
                                                    }
                                                </div>
                                                <div class="col-sm-3"><strong>عميل مهم:</strong></div>
                                                <div class="col-sm-3">
                                                    @if (Model.VIP == true)
                                                    {
                                                        <span class="badge bg-warning">نعم</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-secondary">لا</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            @if (Model.Status == "NEW" || Model.Status == "PENDING")
                                            {
                                                <div class="d-grid gap-2">
                                                    <form asp-action="Authorize" method="post" class="d-inline">
                                                        <input type="hidden" name="id" value="@Model.Serial" />
                                                        <button type="submit" class="btn btn-success w-100" 
                                                                onclick="return confirm('هل أنت متأكد من اعتماد هذا الشيك؟')">
                                                            <i class="fas fa-check me-1"></i>
                                                            اعتماد الشيك
                                                        </button>
                                                    </form>
                                                    <button type="button" class="btn btn-danger w-100" 
                                                            data-bs-toggle="modal" data-bs-target="#returnModal">
                                                        <i class="fas fa-times me-1"></i>
                                                        إرجاع الشيك
                                                    </button>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- History and Notes -->
                        @if (!string.IsNullOrEmpty(Model.History) || !string.IsNullOrEmpty(Model.specialNote))
                        {
                            <div class="col-12">
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">
                                            <i class="fas fa-history me-2"></i>
                                            التاريخ والملاحظات
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        @if (!string.IsNullOrEmpty(Model.specialNote))
                                        {
                                            <div class="alert alert-info">
                                                <strong>ملاحظة خاصة:</strong> @Model.specialNote
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(Model.History))
                                        {
                                            <div class="border p-3 bg-light">
                                                <strong>تاريخ المعاملة:</strong>
                                                <pre class="mt-2 mb-0">@Model.History</pre>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        <!-- System Information -->
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">
                                        <i class="fas fa-server me-2"></i>
                                        معلومات النظام
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="row mb-2">
                                                <div class="col-sm-4"><strong>تاريخ الإدخال:</strong></div>
                                                <div class="col-sm-8">@Model.InputDate?.ToString("dd/MM/yyyy HH:mm")</div>
                                            </div>
                                            <div class="row mb-2">
                                                <div class="col-sm-4"><strong>المستخدم:</strong></div>
                                                <div class="col-sm-8">@Model.UserId</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="row mb-2">
                                                <div class="col-sm-4"><strong>آخر تحديث:</strong></div>
                                                <div class="col-sm-8">@Model.LastUpdate?.ToString("dd/MM/yyyy HH:mm")</div>
                                            </div>
                                            <div class="row mb-2">
                                                <div class="col-sm-4"><strong>محدث بواسطة:</strong></div>
                                                <div class="col-sm-8">@Model.LastUpdateBy</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Return Modal -->
<div class="modal fade" id="returnModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="Return" method="post">
                <input type="hidden" name="id" value="@Model.Serial" />
                <div class="modal-header">
                    <h5 class="modal-title">إرجاع الشيك</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="returnCode" class="form-label">كود الإرجاع</label>
                        <select name="returnCode" id="returnCode" class="form-select" required>
                            <option value="">اختر كود الإرجاع</option>
                            <!-- Add return codes here -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="returnReason" class="form-label">سبب الإرجاع</label>
                        <textarea name="returnReason" id="returnReason" class="form-control" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="submit" class="btn btn-danger">إرجاع الشيك</button>
                </div>
            </form>
        </div>
    </div>
</div>

