@{
    ViewData["Title"] = "صفحة الاختبار";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid" dir="rtl">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-flask me-2"></i>
                        صفحة الاختبار
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h5 class="mb-0">اختبار النظام</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">هذه صفحة اختبار بسيطة للتأكد من عمل النظام بشكل صحيح.</p>
                                    <button type="button" class="btn btn-success" onclick="testFunction()">
                                        <i class="fas fa-play me-2"></i>
                                        تشغيل الاختبار
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="mb-0">معلومات النظام</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between">
                                            <span>إصدار النظام:</span>
                                            <span class="badge bg-primary">ASP.NET Core 8.0</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between">
                                            <span>حالة النظام:</span>
                                            <span class="badge bg-success">يعمل بشكل طبيعي</span>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between">
                                            <span>آخر تحديث:</span>
                                            <span class="badge bg-info">@DateTime.Now.ToString("yyyy-MM-dd")</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card border-secondary">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="mb-0">نتائج الاختبار</h5>
                                </div>
                                <div class="card-body">
                                    <div id="testResults" class="alert alert-info" style="display: none;">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <span id="testMessage">جاري تشغيل الاختبار...</span>
                                    </div>
                                    <div class="progress" id="testProgress" style="display: none;">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                             role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function testFunction() {
    // إظهار نتائج الاختبار
    document.getElementById('testResults').style.display = 'block';
    document.getElementById('testProgress').style.display = 'block';
    
    let progress = 0;
    const progressBar = document.querySelector('.progress-bar');
    const testMessage = document.getElementById('testMessage');
    
    const interval = setInterval(() => {
        progress += 10;
        progressBar.style.width = progress + '%';
        
        if (progress === 50) {
            testMessage.textContent = 'جاري فحص الاتصال بقاعدة البيانات...';
        } else if (progress === 80) {
            testMessage.textContent = 'جاري فحص الصلاحيات...';
        } else if (progress === 100) {
            testMessage.textContent = 'تم الانتهاء من الاختبار بنجاح!';
            document.getElementById('testResults').className = 'alert alert-success';
            progressBar.className = 'progress-bar bg-success';
            clearInterval(interval);
            
            // إظهار رسالة نجاح
            setTimeout(() => {
                Swal.fire({
                    title: 'نجح الاختبار!',
                    text: 'تم تشغيل جميع اختبارات النظام بنجاح',
                    icon: 'success',
                    confirmButtonText: 'موافق'
                });
            }, 500);
        }
    }, 200);
}

// تحميل SweetAlert2 للرسائل
if (!window.Swal) {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/sweetalert2@11';
    document.head.appendChild(script);
}
</script>

